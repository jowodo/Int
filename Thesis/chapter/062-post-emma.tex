\subsection{Post-EMMA}
\label{sec:res-post-emma}
%describe what awaits the reader in this chapter:
In this section the experimental results are analyzed with different methods and compared with the original method EMMA which was integrated into the experiment selection process. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\subsubsection{ANOVA}\label{sec:res-anova}
%\textbf{EMMA}
The \gls{rf}s produced by the last iteration of \gls{emma} (see equations \ref{eq:emma-phd4} and \ref{eq:emma-G4}) put a high significance
%/effect/correlation
on the calcination temperature $T_{cal}$ with regard to the 
measures of the conductance. 
\Gls{anova} is used to double check this. 
%Now \gls{anova} can be used to check if the data 
%\td{ANOVA was used to check if \gls{bf} identified by \gls{emma} are reasonable.} 

\textbf{What can/did we test?}
the probability of arriving at these results was by pure chance can be checked with \gls{anova}. 
The null hypothesis is that the results were obtained by pure chance without any dependence of the insulation of a sample on the process variables.
%We tested for each input variable the influence on rho and gamma 
A one-way \gls{anova} was performed for every independent variable on $\rho$ and $\gamma$. 
%and also as a test on vcal and $\lambda$. 
We used an $\alpha$ value of 0.05 which means that 
the null hypothesis is rejected if the p-value is under 0.05. 
Usually, the $\alpha$-value is chosen to be 0.01 or 0.05\cite{hoffman2020concept,sellke2001pvalues}.
The choice of a relatively high $alpha$-value is motivated by the rather small amount of data and low events per varible ratio.
\ds{
As mentioned by Sellke et al.\cite{sellke2001pvalues} a p-value of 0.05 might tempt 
to guess that in 1 out of 20 cases the results could be false positives, 
whereas the frequency is much higher. 
A p-value of 0.01 and 0.05  mean that under the assumption that the null hypothesis is correct, 
there is a 1\% and 5\% chance of arriving at such data as observed.
%The results should thus be taken with a grain of salt. 
}
%1 out of 20 times this result could be 
%produced by pure chance given that the null hypothesis is true. 
%If the p-value is below that value, then we choose to accept, that the data is not due to
%chance but due to the influence of the independent variables on the dependent variables. 
%\td{could test anova on different generations data sets} 

\textbf{What were the results?}
%\Gls{anova} shows that for the mentioned indep and dep pairs, the means divided by 
%indep groups are not equal and that there is at least one group that is different. 
For both $\rho$ and $\lambda$ (for both the \gls{emma} dataset and the extended dataset (=\gls{emma}+pre\gls{emma})) 
the F-values for $T_{cal}$ were in all cases under 0.01, 
indicating a real influence of $T_{cal}$ on the conductance.
Furthermore, both datasets exhibit a p-value $< 0.05$ for the interaction $T_{cal}$:$v_{cal}$ on $\rho$
and the extended data set has p-value smaller than 0.01 of $v_{cal}$ on $\rho$. 
Whereas $v_{cal}$ on $\rho$ for \gls{emma} dataset has p-value of slightly over 0.05
%\td{why tcal:vcal on phd the same for both datasets? zufall}

\textbf{What do the results mean?} 
\Gls{anova} confirms that $T_{cal}$ has influence on both $\gamma$ and $\rho$. 
It seems that the probability of getting such data per chance that Tcal has no influence 
(null hypothesis is true) is less then 5\% (even less than 1\%). 
%\td{NO bcs \cite{sellke2001pvalues}}
It is important to mention, that \gls{anova} assumes categorical data for inputs, 
where our data is numerical and thus information is lost. 

%\textbf{Pre-writing:}
%\Gls{anova} doesn't provide a lot of extra information. 
%wrong the second is not for phd but for extended data set
%but for phd even lower than 0.1 \%
%Anova shows that the influence of TCal is significant as shown by the F 

%%%%%%%%%%%%%%%%%%%% LIN REG %% lin reg %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\subsubsection{Linear Regression} 
%Initially, it was thought that the resulting layer and thus resistance of a sample is mainly influennced by the Zirconium concentrain in the starting solution $c_{zr}$ and the number of layers applied $\lambda$, but their coefficients are the smallest in absolute values. 

%\todo{what was fitted how?}
The data obtained from the \gls{emma} optimisation was used to fit a linear model. 
The biggest difference of the linear model to \gls{emma} is that all variables are included, that the \gls{bf}s are strictly linear and that there are no interaction terms. 
The coefficients of the $\lambda$ term have the same sign in equations \ref{eq:emma-phd3},\ref{eq:emma-G3},\ref{eq:emma-phd4},\ref{eq:emma-G4} (\gls{emma} \gls{rf}s) and \ref{eq:linreg-phd},\ref{eq:linreg-G} and have comparable magnitudes too. 
%
%Initially, it was thought that the resulting layer and thus resistance of a sample is mainly influenced by
%but their coefficients are the smallest in absolute values. 
%
\begin{align}
	\begin{split}
		\label{eq:linreg-phd}
		\hat{\rho} &=  -0.022\cdot c_{zr} -0.022\cdot \lambda -0.0029\cdot v_{DB} + 0.0058\cdot T_{DB} \\
		& -8.5\cdot 10^{-5}\cdot v_{cal} + 0.0026\cdot T_{cal} -0.76
	\end{split}
	\\
	\begin{split}
		\label{eq:linreg-G}
		\hat{\gamma} &={}  \qquad 3.2\cdot c_{zr} \,\, - 0.97\cdot \lambda \,\,\quad - 1.2\cdot v_{DB} + \,\,\,\quad 0.2\cdot T_{DB} \\
			& \qquad - 0.014\cdot v_{cal} \quad + 0.13\cdot T_{cal} + 7.2
%		\hat{\gamma} ={} & 3.2\cdot c_{zr} - 0.97\cdot \lambda - 1.2\cdot v_{DB} + 0.2\cdot T_{DB} \\
%			& - 0.014\cdot v_{cal} + 0.13\cdot T_{cal} + 7.2
	\end{split}
\end{align}
%
All terms in equations \ref{eq:linreg-phd} and \ref{eq:linreg-G} have the same sign except the intercept and $c_{zr}$. 
%
More particularly, $T_{cal}$ and $T_{DB}$ have positive coefficients, i.e. a negative influence on the resistance 
and $\lambda$, $v_{DB}$ and $v_{cal}$ have negative coefficients, i.e. a positive influence on resistance. 
An indication that the data is strongly tainted by noise (see also section \ref{sec:res-anova}) is the low $R^2$ score of 0.41 of $\hat\rho$, 
which is (sad but true) even undercut by the $R^2$ of linear fit of $\hat\gamma$, 0.34. 
%The coefficients, though share the signs. 
%This is only true if the extended data set is used and therefore again rather by chance. 
When the linear regression is trained on the complete data set, all terms have the same sign compared to the \gls{emma} data set trained linear model. 
%It is even more astounding that \gls{emma} managed to decrease the average of $\gamma$ an $\rho$ with each generation (see figure \ref{fig:emma-gen}.
$v_{cal}$ and $\lambda$ are well predicted by linear regression as there is a perfect direct proportionality and thus are not displayed here. 
%
\begin{table}[htb]
	\center
	\begin{tabular}{cccccccc}
		        & $c_{zr}$      & $\lambda$     & $v_{DB}$      & $T_{DB}$      & $v_{cal}$     & $T_{cal}$\\
				\hline\hline
				$\hat\rho$          &2.04   &46.58  &1.15   &9.21   &13.50  &27.52\\
				$\hat\gamma$        &10.24  &7.10   &16.46  &10.97  &7.68   &47.55\\
				\hline\hline
	\end{tabular}
	\label{tab:lin-reg-influence}
	\caption{Influences of input variables on output variables in percent according to linear regression.}
\end{table}

%
Regarding the coefficients of the linear model, the zirconium concentration in the starting solution $c_{zr}$ and the number of layers applied $\lambda$ are largest in value, but the values which are taken by $c_{zr}$ and $\lambda$ itself are the smallest among the input variables. 
Thus, even though $T_{cal}$ might have a smaller coefficient in the linear \gls{rf}, the influence on the dependent variable might be larger. 
In order to compare, the influence was calculated by the formula: $I(x_i)=\frac{\bar{x}_i \cdot k_i}{\sum_i \bar{x}_i \cdot k_i}$ with $i=1,\dots,d $ and where $\bar{x}_i= \frac{(x_{min}+x_{max})}{2}$ is average possible value of the $i$-th input variable and $k_i$ is the coefficient of the $i$-th input variable in the linear regression. 
%The biggest influence on $\rho$ is indeed $T_{cal}$, next with about a third of the influence $T_{DB}$. 
The biggest influence on $\hat\rho$ is  $\lambda$, followed by $T_{cal}$. 
While $T_{cal}$ is the second largest influence on $\hat\rho$ as well it is noteworthy that $\lambda$ contributes the least to $\hat\gamma$. 
That means that according to the linear regression, the number of layers increases the overall resistance of the zirconium ceramics while a lower calcination temperature leads to less defects. 
Interestingly, the number of layers has the least amount of influence on the number probability of defects, which seems to be an artefact of the noise rather than a process property. 
%Furthermore the influence on $\hat\rho$ is dominated by $\lambda$ and $T_{cal}$, while the influences on $\hat\gamma$ are distributed more evenly.
%Different distributions were not expected. 
The two very different distributions of influence among the input variables can have three reasons:
%This can have two reasons: 
(1) the linear function is not a suitable regression function for the data distribution.
(2) the signal to noise ratio is so low that the noise rather than the signal was fitted.
(3) the \textit{optimizands} indeed represent different properties of the material.
%either the *optimizands* darstellen differen properties and/or signal to noise ratio is too low.
%

%Do multi linear reg like in Peprah et al. 2017\cite{peprah2017appraisal}.
%

%MSE(data=all) =427
%MSE(data=emma)=250

%\iffalse
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ML %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% GRID SEARACH %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\subsubsection{Grid Search}
The ideal hyper parameters have to be found for \gls{krr} and \gls{svm}.
To do so a grid search over a set of hyper parameters was executed. 
Both \gls{krr} and \gls{svm} following kernel: radial basis function, sigmoid, and polynomial with degree 1 to 4. 
%
%https://scikit-learn.org/stable/auto_examples/svm/plot_rbf_parameters.html#sphx-glr-auto-examples-svm-plot-rbf-parameters-py
%https://scikit-learn.org/stable/modules/svm.html#svc
%
\td{which parameters?}
The parameters which were examined in \gls{krr} were kernel, $\gamma_{ml}$ and $\alpha$.
The kernel took the form of \gls{rbf}, sigmoid and polynomial with degree 1--4.
The parameters $\alpha$ and $\gamma_{ml}$ (subscript to distinguish from \textit{optimizand}) took the values 0.01, 0.02, 0.05, 0.1, 0.2, 0.5, 1, 2
and 0.01, 0.05, 0.1, 0.5, 1.0, 5, 10, respectively.
Note that $\gamma_{ml}$ is used differently in each kernel. 
The kernels for \gls{svm} were the same and further hyper parameters were 
$C$, $\varepsilon$ and $\gamma_{ml}$, where $C$ took the values 0.05--0.95 with 0.05 steps, $\varepsilon$ 0.02--3.8 with 0.2 steps and $\gamma_{ml}$ 0.01, 0.05, 0.1, 0.5, 1, 5, 10, and \texttt{scale}. 
Where \texttt{scale} equals to $\frac{1}{d \cdot \sigma(\mathbf{X})}$ with $d$ being the number of features 
and $\sigma(\mathbf{X})$ the variance of the input variables. 
%
\td{how and what?}
Each grid search calculation was calculated with and without scaling the data before the optimisation. 
For each optimisation \gls{mae}, \gls{mse}, $sigma(\mathbf{y})$ and $\sigma(\mathbf{\hat{y}})$ were calculated. 
For each method (\gls{krr} and \gls{svm}) and each kernel the parameters with the lowest \gls{mae} were chosen. 
%
\td{what were best results/hyper parameters}


%Since the data set was very small, I could be generous with the grid search even on relatively humble hardware (intel i7-8550U). 

\begin{table}[htb]
	\centering
    \caption{Post EMMA vergleich}
	\label{tab:post-emma}
	\begin{tabular}{c cc cc cc cc}
    \hline\hline
    G&  MAEe&   MSEe&   MAEp&   MSEp&   MAEc&   MSEc&   MAEa& MSEa \\
    \hline
        MARS&   10& 171&    28& 1084&   30& 1280&   17& 548\\
        lin Reg&    13& 250&    24& 747&    34& 1327&   17& 454\\
        KRR& 15& 415&    26& 1048&   28& 1586&   19& 676\\
        SVM& 15&  415&    26& 1050&   28& 1588&   19& 677\\
    \hline\hline
	\end{tabular}
    %
	\begin{tabular}{c cc cc cc cc}
    \hline\hline
    p&  MAEe&   MSEe&   MAEp&   MSEp&   MAEc&   MSEc&   MAEa& MSEa \\
    \hline
        MARS&   0.14&   0.03&   0.41&   0.21&   0.39&   0.18&   0.25&   0.11\\
        lin Reg&    0.19&   0.06&   0.30&   0.15&   0.38&   0.13&   0.24&   0.09\\
        KRR& 0.30&   0.22&   0.47&   0.38&   0.52&   0.44&   0.34&   0.26\\
        SVM& 0.28&   0.12&   0.37&   0.21&   0.42&   0.25&   0.32&   0.16\\
    \hline\hline
	\end{tabular}
\end{table}
    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\subsubsection{KRR}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\subsubsection{SVM}
\td{plot the predicted data for variables which should be excluded (Tcal, Vcal,Conc, layers)}


%\fi

\iffalse
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\subsubsection{PCR?}
\subsubsection{Further}
\begin{itemize}
    \item grid search
    \item KRR (start with grid search) (???)
    \item SVM (start with grid search) (???)
    \item \url{https://blog.minitab.com/en/adventures-in-statistics-2/regression-smackdown-stepwise-versus-best-subsets}
    \item \url{https://blog.minitab.com/en/how-to-choose-the-best-regression-model}
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\subsubsection{Comparison} 
compare all methods. 
How should I compare them? 
What are the measurables. 
\fi


\td{do regression for avg(-log(G)) instead of $\gamma$=avg( ( 13+log(G))**2)} 
